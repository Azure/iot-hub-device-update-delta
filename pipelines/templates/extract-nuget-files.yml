# File: extract-nuget-files.yml

parameters:
# Required Parameters
- name: nuget_files_extract_dir
  type: string

steps:

- task: CmdLine@2
  displayName: 'Show inputs'
  inputs:
    script: echo Downloading nuget to $(Pipeline.Workspace)/drop/nuget. Nuget name is Microsoft.Azure.DeviceUpdate.Diffs.$(semver_version).nupkg. Extract target is ${{ parameters.nuget_files_extract_dir }}

- task: DownloadPipelineArtifact@2
  displayName: 'Download Nuget'
  inputs:
    buildType: current
    artifactName: 'nuget'
    targetPath: $(Pipeline.Workspace)/drop/nuget

- task: CmdLine@2
  displayName: 'Show nuget file'
  inputs:
    script: |
      ls $(Pipeline.Workspace)/drop/nuget

- task: ExtractFiles@1
  inputs:
    archiveFilePatterns: $(Pipeline.Workspace)/drop/nuget/Microsoft.Azure.DeviceUpdate.Diffs.$(semver_version).nupkg
    destinationFolder: ${{ parameters.nuget_files_extract_dir }}

- task: PowerShell@2
  inputs:
    targetType: inline
    script: |
      tree ${{ parameters.nuget_files_extract_dir }}
  displayName: 'Show extracted files.'
  condition: eq( variables['Agent.OS'], 'Windows_NT' )

- task: CmdLine@2
  inputs:
    script: |
      tree ${{ parameters.nuget_files_extract_dir }}
  displayName: 'Show extracted files.'
  condition: eq( variables['Agent.OS'], 'Linux' )